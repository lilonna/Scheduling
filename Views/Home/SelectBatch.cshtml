@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model IEnumerable<Scheduling.Models.Batch>

@{
    ViewData["Title"] = "Select a Batch and Department";
}

<h2>Select Batch and Department</h2>

<form method="get" asp-controller="Home" asp-action="ViewSectionByBatch">
    <div class="mb-3 w-50">
        <label for="batchId" class="form-label">Batch</label>
        <select id="batchId" name="batchId" class="form-select" required>
            <option value="">-- Select Batch --</option>
            @foreach (var batch in Model)
            {
                <option value="@batch.Id">@batch.Name</option>
            }
        </select>
    </div>

    <div class="mb-3 w-50">
        <label for="departmentId" class="form-label">Department</label>
        <select id="departmentId" name="departmentId" class="form-select" disabled required>
            <option value="">-- Select Department --</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary mt-3" disabled id="submitBtn">View Schedule</button>
</form>

@section Scripts {
    <script>
        const batchSelect = document.getElementById('batchId');
        const deptSelect = document.getElementById('departmentId');
        const submitBtn = document.getElementById('submitBtn');

        batchSelect.addEventListener('change', function () {
            const batchId = this.value;
            deptSelect.innerHTML = '<option>Loading...</option>';
            deptSelect.disabled = true;
            submitBtn.disabled = true;

            if (batchId) {
                fetch(`/Home/GetDepartmentsByBatch?batchId=${batchId}`)
                    .then(res => res.json())
                    .then(data => {
                        deptSelect.innerHTML = '<option value="">-- Select Department --</option>';
                        data.forEach(dept => {
                            deptSelect.innerHTML += `<option value="${dept.id}">${dept.name}</option>`;
                        });
                        deptSelect.disabled = false;
                    });
            }
        });

        deptSelect.addEventListener('change', function () {
            submitBtn.disabled = !this.value;
        });
    </script>
}

